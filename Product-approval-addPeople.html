<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>创维项目立项模块人员添加</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">


    <link rel="stylesheet" href="lib/layui/css/layui.css" media="all">
    <!-- 注意：如果你直接复制所有代码到本地，上述css路径需要改成你本地的 -->
    <link rel="stylesheet" href="css/dtree.css" media="all">
    <link rel="stylesheet" href="css/dtreefont.css" media="all">

    <!--[if lt IE 9]>
    <script src="https://cdn.staticfile.org/html5shiv/r29/html5.min.js"></script>
    <script src="https://cdn.staticfile.org/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
    <style type="text/css">
        .select-test {
            position: absolute;
            max-height: 500px;
            height: 350px;
            overflow: auto;
            width: 100%;
            z-index: 123;
            display: none;
            border: 1px solid silver;
            top: 42px;
        }

        .layui-show {
            display: block !important;
        }
    </style>

</head>
<body>

<!--模块选择-->
<form class="layui-form layui-form-pane" action="">
    <div class="layui-form-item">
        <label class="layui-form-label">所属模块</label>
        <div class="layui-input-inline" style="width: 60%">
            <select name="interest" lay-filter="moduleChoice">
                <option value=""></option>
                <option value="0" selected="">业务模块</option>
                <option value="1">计划模块</option>
                <option value="2">质量模块</option>
                <option value="3">工程模块</option>
                <option value="4">生产模块</option>
            </select>
        </div>
    </div>
</form>

<!--部门选择-->
<div class="layui-form layui-form-pane">
    <div class="layui-form-item">
        <label class="layui-form-label">所属部门</label>
        <div class="layui-input-inline" style="width: 60%">
            <div class="layui-unselect layui-form-select" id="departmentChoice">
                <div class="layui-select-title">
                    <input type="text" name="department" id="input_department" placeholder="请选择" readonly=""
                           class="layui-input layui-unselect">
                    <i class="layui-edge"></i>
                </div>
            </div>
            <div class="layui-card select-test" id="departmentChoice-select">
                <div class="layui-card-body">
                    <div id="toolbarDiv1">
                        <ul id="slTree1" class="dtree" data-id="0" style="width: 100%;"></ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!--人员选择-->
<div class="layui-form layui-form-pane">
    <div class="layui-form-item">
        <label class="layui-form-label">部门人员</label>
        <div class="layui-input-inline" style="width: 60%">
            <div class="layui-unselect layui-form-select" id="departmentPeopleChoice">
                <div class="layui-select-title">
                    <input type="text" name="departmentPeople" id="input_departmentPeople" placeholder="请选择" readonly=""
                           class="layui-input layui-unselect">
                    <i class="layui-edge"></i>
                </div>
            </div>
            <div class="layui-card select-test" id="departmentPeopleChoice-select">
                <div class="layui-card-body">
                    <div id="toolbarDiv2">
                        <ul id="slTree2" class="dtree" data-id="0" style="width: 100%;"></ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

</body>
<script src="lib/layui/layui.js" charset="utf-8"></script>
<!-- 注意：如果你直接复制所有代码到本地，上述js路径需要改成你本地的 -->

<script>

    layui.config({
        base: "lib/layui/lay/mymodules/"
    }).use(['dtree', 'layer', 'jquery'], function () {
        var dtree = layui.dtree, layer = layui.layer, $ = layui.jquery;

        $.ajax({
            type: "GET",
            url: "http://172.20.73.16:8080/safe_usercenter/safe/department/getDepartmentTree",
            success: function (res) {
                console.log(res);
                //初始化树
                var DTree = dtree.render({
                    elem: "#slTree1",
                    data: [res],
                    response: {title: "text"}, // 这里指定了返回的数据格式，组件会根据这些值来替换返回JSON中的指定格式，从而读取信息
                    // ficon: "-1",  // 隐藏一级图标
                    // dot: false,  // 隐藏小圆点
                    icon: -1,
                    accordion: true,
                    none: "接口数据异常，请检查服务是否开启",
                    done: function (res) {
                        console.log("libinglin shi zui shuai de !")
                    }
                });

                $("#departmentChoice").on("click", function () {
                    $(this).toggleClass("layui-form-selected");
                    $("#departmentChoice-select").toggleClass("layui-show layui-anim layui-anim-upbit");
                });
                dtree.on("node(slTree1)", function (obj) {
                    $("#input_department").val(obj.param.context);
                    $("#depatment").toggleClass("layui-form-selected");
                    $("#departmentChoice-select").toggleClass("layui-show layui-anim layui-anim-upbit");
                });
                // $("#departmentPeopleChoice").on("click", function () {
                //     $(this).toggleClass("layui-form-selected");
                //     $("#departmentPeopleChoice-select").toggleClass("layui-show layui-anim layui-anim-upbit");
                // });
                // dtree.on("node(slTree1)", function (obj) {
                //     $("#input_departmentPeople").val(obj.param.context);
                //     $("#depatmentPeople").toggleClass("layui-form-selected");
                //     $("#departmentPeopleChoice-select").toggleClass("layui-show layui-anim layui-anim-upbit");
                // });
            }
        });
        // 点击节点触发回调，其中obj内包含丰富的数据，打开浏览器F12查看！
        dtree.on("node('slTree1')" ,function(obj){
            layer.msg(JSON.stringify(obj.param));
            console.log(obj.param); // 点击当前节点传递的参数
            console.log(obj.dom); // 当前节点的jquery对象
            console.log(obj.childParams); // 当前节点的所有子节点参数
            console.log(obj.parentParam); // 当前节点的父节点参数
        });

    });
</script>

<!--<script>-->
<!--    layui.use(['form', 'layedit', 'laydate'], function () {-->
<!--        var form = layui.form-->
<!--            , layer = layui.layer-->
<!--            , layedit = layui.layedit-->
<!--            , laydate = layui.laydate;-->

<!--        //日期-->
<!--        laydate.render({-->
<!--            elem: '#date'-->
<!--        });-->
<!--        laydate.render({-->
<!--            elem: '#date1'-->
<!--        });-->

<!--        //创建一个编辑器-->
<!--        var editIndex = layedit.build('LAY_demo_editor');-->

<!--        //自定义验证规则-->
<!--        form.verify({-->
<!--            title: function (value) {-->
<!--                if (value.length < 5) {-->
<!--                    return '标题至少得5个字符啊';-->
<!--                }-->
<!--            }-->
<!--            , pass: [-->
<!--                /^[\S]{6,12}$/-->
<!--                , '密码必须6到12位，且不能出现空格'-->
<!--            ]-->
<!--            , content: function (value) {-->
<!--                layedit.sync(editIndex);-->
<!--            }-->
<!--        });-->

<!--        //监听指定开关-->
<!--        form.on('switch(switchTest)', function (data) {-->
<!--            layer.msg('开关checked：' + (this.checked ? 'true' : 'false'), {-->
<!--                offset: '6px'-->
<!--            });-->
<!--            layer.tips('温馨提示：请注意开关状态的文字可以随意定义，而不仅仅是ON|OFF', data.othis)-->
<!--        });-->

<!--        //监听提交-->
<!--        form.on('submit(demo1)', function (data) {-->
<!--            layer.alert(JSON.stringify(data.field), {-->
<!--                title: '最终的提交信息'-->
<!--            })-->
<!--            return false;-->
<!--        });-->

<!--        //表单初始赋值-->
<!--        form.val('example', {-->
<!--            "username": "贤心" // "name": "value"-->
<!--            , "password": "123456"-->
<!--            , "interest": 1-->
<!--            , "like[write]": true //复选框选中状态-->
<!--            , "close": true //开关状态-->
<!--            , "sex": "女"-->
<!--            , "desc": "我爱 layui"-->
<!--        })-->


<!--    });-->
<!--</script>-->

</html>