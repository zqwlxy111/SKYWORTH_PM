<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>创维项目立项模块人员添加</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">


    <link rel="stylesheet" href="lib/layui/css/layui.css" media="all">
    <!-- 注意：如果你直接复制所有代码到本地，上述css路径需要改成你本地的 -->
    <link rel="stylesheet" href="css/dtree.css" media="all">
    <link rel="stylesheet" href="css/dtreefont.css" media="all">

    <!--[if lt IE 9]>
    <script src="https://cdn.staticfile.org/html5shiv/r29/html5.min.js"></script>
    <script src="https://cdn.staticfile.org/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
    <style type="text/css">
        .select-test {
            position: absolute;
            max-height: 500px;
            height: 350px;
            overflow: auto;
            width: 100%;
            z-index: 123;
            display: none;
            border: 1px solid silver;
            top: 42px;
        }

        .layui-show {
            display: block !important;
        }
    </style>

</head>
<body>

<div class="layui-container" style="margin-left: 6%; margin-top: 6%">
    <!--模块选择-->
    <form class="layui-form layui-form-pane" action="">
        <div class="layui-form-item">
            <label class="layui-form-label">所属模块</label>
            <div class="layui-input-inline" style="width: 65%">
                <select name="interest" lay-filter="moduleChoice">
                    <option value=""></option>
                    <option value="0" selected="">业务模块</option>
                    <option value="1">计划模块</option>
                    <option value="2">质量模块</option>
                    <option value="3">工程模块</option>
                    <option value="4">生产模块</option>
                </select>
            </div>
        </div>
    </form>

    <!--部门选择-->
    <div class="layui-form layui-form-pane">
        <div class="layui-form-item">
            <label class="layui-form-label">所属部门</label>
            <div class="layui-input-inline" style="width: 65%">
                <div class="layui-unselect layui-form-select" id="departmentChoice">
                    <div class="layui-select-title">
                        <input type="text" name="department" id="input_department" placeholder="请选择部门" readonly=""
                               class="layui-input layui-unselect">
                        <i class="layui-edge"></i>
                    </div>
                </div>
                <div class="layui-card select-test" id="departmentChoice-select">
                    <div class="layui-card-body">
                        <div id="toolbarDiv1">
                            <ul id="slTree1" class="dtree" data-id="0" style="width: 100%;"></ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!--人员选择-->
    <div class="layui-form layui-form-pane">
        <div class="layui-form-item">
            <label class="layui-form-label">部门人员</label>
            <div class="layui-input-inline" style="width: 65%">
                <select name="quiz" id="departmentPeopleChoice">
                    <option value="">请选择人员</option>
                </select>
                <!--            <div class="layui-unselect layui-form-select" id="departmentPeopleChoice">-->
                <!--                <div class="layui-select-title">-->
                <!--                    <input type="text" name="departmentPeople" id="input_departmentPeople" placeholder="请选择" readonly=""-->
                <!--                           class="layui-input layui-unselect">-->
                <!--                    <i class="layui-edge"></i>-->
                <!--                </div>-->
                <!--            </div>-->
                <!--            <div class="layui-card select-test" id="departmentPeopleChoice-select">-->
                <!--                <div class="layui-card-body">-->
                <!--                    <div id="toolbarDiv2">-->
                <!--                        <ul id="slTree2" class="dtree" data-id="0" style="width: 100%;"></ul>-->
                <!--                    </div>-->
                <!--                </div>-->
                <!--            </div>-->
            </div>
        </div>
    </div>

    <!--人员职责-->
    <div class="layui-form layui-form-pane">
        <div class="layui-form-item layui-form-text" style="width: 92%;">
            <label class="layui-form-label" >人员职责</label>
            <div class="layui-input-block">
                <textarea placeholder="请输入内容" class="layui-textarea"></textarea>
            </div>
        </div>
    </div>
</div>

</body>
<script src="lib/layui/layui.js" charset="utf-8"></script>
<!-- 注意：如果你直接复制所有代码到本地，上述js路径需要改成你本地的 -->

<script>
    layui.config({
        base: "lib/layui/lay/mymodules/"
    }).use(['dtree', 'form', 'layer', 'jquery'], function () {
        var dtree = layui.dtree, layer = layui.layer, form = layui.form, $ = layui.jquery;

        // 定义一个departmentid变量
        var departmentId = null;

        $.ajax({
            type: "GET",
            url: "http://172.20.73.16:8080/safe_usercenter/safe/department/getDepartmentTree",
            // url: "https://www.easy-mock.com/mock/5cf1600306cab27e589f9550/safe_usercenter/safe/department/getDepartmentTree",
            success: function (res) {
                console.log(res);
                //初始化树
                var DTree = dtree.render({
                    elem: "#slTree1",
                    data: [res],
                    response: {title: "text"}, // 这里指定了返回的数据格式，组件会根据这些值来替换返回JSON中的指定格式，从而读取信息
                    // ficon: "-1",  // 隐藏一级图标
                    // dot: false,  // 隐藏小圆点
                    icon: -1,
                    line: true,
                    accordion: false,
                    cache: true,
                    initLevel: 8
                });
            }
        });

        $("#departmentChoice").on("click", function () {
            $(this).toggleClass("layui-form-selected"); // 控制旁边的小三角符号
            $("#departmentChoice-select").toggleClass("layui-show layui-anim layui-anim-upbit"); // show控制select下拉框的是否显示，anim和upbit控制显示的动画效果
            $(".layui-form-selected").toggleClass("layui-form-selected");
        });

        dtree.on("node(slTree1)", function (obj) {
            $("#input_department").val(obj.param.context);
            $("#department").toggleClass("layui-form-selected");
            $("#departmentChoice-select").toggleClass("layui-show layui-anim layui-anim-upbit");
            departmentId = obj.param.nodeId;
            $.ajax({
                type: "GET",
                url: "http://172.20.73.16:8080/safe_usercenter/safe/user/getUsersListByDepartmentId?departmentId=" + departmentId + "&start=0&limit=100",
                // url: "https://www.easy-mock.com/mock/5cf1600306cab27e589f9550/safe_usercenter/safe/department/getDepartmentTree?nodeId=" + nodeid,
                success: function (res1) {
                    $("#departmentPeopleChoice").empty();
                    $("#departmentPeopleChoice").append("<option value=''>请选择人员</option>");
                    for (var i = 0; i < res1.result.length; i++) {

                        $("#departmentPeopleChoice").append("<option value='test' type='text'>" + res1.result[i].realName + "</option>");

                    }
                    // 对目标form表单进行动态的重新渲染
                    form.render();

                }
            });
        });
        // $("#departmentPeopleChoice").on("click", function () {
        //     $(this).toggleClass("layui-form-selected");
        //     $("#departmentPeopleChoice-select").toggleClass("layui-show layui-anim layui-anim-upbit");
        //
        // });

        // dtree.on("node(slTree2)", function (obj1) {
        //     $("#input_departmentPeople").val(obj1.param.context);
        //     $("#departmentPeople").toggleClass("layui-form-selected");
        //     $("#departmentPeopleChoice-select").toggleClass("layui-show layui-anim layui-anim-upbit");
        // });
    });
</script>
</html>